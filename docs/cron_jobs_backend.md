# Cron Jobs - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

## –û–±–∑–æ—Ä

–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ (cron jobs) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å–¥–µ–ª–æ–∫ –≤ AmoCRM. –í—Å–µ cron –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –≤–æ—Ä–æ–Ω–∫–æ–π RealtyCalendar (ID: 9266190).

---

## üìã –ê–∫—Ç–∏–≤–Ω—ã–µ Cron Jobs

### 1. `checkInstructions.php` - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `0 7 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 7:00 —É—Ç—Ä–∞)

**–§–∞–π–ª:** `/amo/checkInstructions.php`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å–¥–µ–ª–æ–∫ –≤ —ç—Ç–∞–ø "–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" –∑–∞ –¥–µ–Ω—å –¥–æ –∑–∞–µ–∑–¥–∞

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- –ü–æ–ª—É—á–∞–µ—Ç –í–°–ï –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–¥–µ–ª–∫–∏ –∏–∑ –≤–æ—Ä–æ–Ω–∫–∏ RealtyCalendar (ID: 9266190)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞—Ç—É –∑–∞–µ–∑–¥–∞ (–ø–æ–ª–µ ID: 833655) –∫–∞–∂–¥–æ–π —Å–¥–µ–ª–∫–∏
- –ï—Å–ª–∏ –∑–∞–µ–∑–¥ –∑–∞–≤—Ç—Ä–∞ ‚Üí –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤ —ç—Ç–∞–ø "–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏" (ID: 74364966)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–¥–µ–ª–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥–ª–∏ "–ø–æ—Ç–µ—Ä—è—Ç—å—Å—è" –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

**–õ–æ–≥–∏:** `/amo/checkin_cron.log`

**–ö–æ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤ crontab:**
```bash
0 9 * * * php /path/to/lenochka178amoBot/amo/checkInstructions.php
```

---

### 2. `moveLeads.php` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–µ–ª–µ–Ω–∏–µ–º

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ù–ï –ù–ê–°–¢–†–û–ï–ù–û –≤ crontab.txt (—Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

**–§–∞–π–ª:** `/amo/moveLeads.php`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤ —ç—Ç–∞–ø "–í—ã—Å–µ–ª–µ–Ω–∏–µ" –∑–∞ –¥–µ–Ω—å –¥–æ –≤—ã–µ–∑–¥–∞

**–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:**
- –ß–∏—Ç–∞–µ—Ç –≤—Å–µ JSON-—Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ `/amo/bookings/`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞—Ç—É –≤—ã–µ–∑–¥–∞ (`end_date`) –∫–∞–∂–¥–æ–π –±—Ä–æ–Ω–∏
- –ï—Å–ª–∏ –≤—ã–µ–∑–¥ –∑–∞–≤—Ç—Ä–∞ –ò —Å–¥–µ–ª–∫–∞ –µ—â—ë –Ω–µ –±—ã–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞ ‚Üí –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –≤ —ç—Ç–∞–ø "–í—ã—Å–µ–ª–µ–Ω–∏–µ" (ID: 74365494)
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∏—Ç —Ñ–ª–∞–≥ `is_moved_amo = 1` –≤ JSON —Ñ–∞–π–ª–µ

**–õ–æ–≥–∏:** `/amo/cron_log.txt`

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** `0 9 * * *` (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 —É—Ç—Ä–∞)

---

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ crontab

```bash
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞–Ω–∏—è
crontab -l > current_crontab

# –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è
cat amo/crontab.txt >> current_crontab

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π crontab
crontab current_crontab

# –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
rm current_crontab
```

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ–ª–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# AmoCRM –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00
0 9 * * * php /path/to/lenochka178amoBot/amo/checkInstructions.php

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã—Å–µ–ª–µ–Ω–∏–µ–º - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00
0 9 * * * php /path/to/lenochka178amoBot/amo/moveLeads.php
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞—Ç

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –º–æ—Å–∫–æ–≤—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º (UTC+3):
```php
// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ timestamp –≤ –º–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è
$date = date('Y-m-d', $timestamp + (3*3600));
```

---

## üö® –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ cron

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ cron –∑–∞–¥–∞—á–∏
crontab -l

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cron —Å–∏—Å—Ç–µ–º—ã
tail -f /var/log/cron
```

### –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤

```bash
# –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
tail -f amo/checkin_cron.log

# –õ–æ–≥–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å–µ–ª–µ–Ω–∏–µ–º
tail -f amo/cron_log.txt
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- `checkInstructions.php` –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–æ 250 —Å–¥–µ–ª–æ–∫ –∑–∞ —Ä–∞–∑
- `moveLeads.php` —á–∏—Ç–∞–µ—Ç –≤—Å–µ JSON —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏ bookings
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–¥–µ–ª–æ–∫ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## üîÑ –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- `processCheckIn.php` - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞—Ç—ã –∑–∞–µ–∑–¥–∞
- `checkInHandler.php` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–µ–∑–¥–∞ –≤ –¥–µ–Ω—å –ø—Ä–∏–±—ã—Ç–∏—è

---
